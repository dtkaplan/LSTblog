<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Daniel Kaplan">
<meta name="dcterms.date" content="2024-02-28">

<title>Instructor Blog for Lessons in Statistical Thinking - Reforming Stat 101 with Lessons in Statistical Thinking</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Instructor Blog for <em>Lessons in Statistical Thinking</em></span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Reforming Stat 101 with <em>Lessons in Statistical Thinking</em></h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Daniel Kaplan </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 28, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p><a href="https://dtkaplan.github.io/Lessons-in-statistical-thinking/"><em>Lessons in Statistical Thinking</em> (LST)</a> is a new text for helping college-level students understand, read, and work with applied statistics as it is practiced today. It is part of a broader project that aims to reform the Stat 101 course so widely taught as the college-level introduction to statistics. Some readers will already be aware of the need for reform; a short case is made in <a href="#sec-reform-case" class="quarto-xref">Section&nbsp;3</a>.</p>
<p>A process of winnowing out topics is central to reforming Stat 101. Instructors often claim that Stat 101 is already overcrowded, leaving no room for additional content reflecting today’s applied statistics practice. Common sense suggests cleaning out low-importance topics. A small set of examples of such topics were given in the <a href="https://www.amstat.org/asa/files/pdfs/GAISE/GaiseCollege_Full.pdf">ASA 2016 College GAISE report</a> in the section titled “Suggestions for topics that might be omitted from introductory statistics courses.”</p>
<p><em>LST</em> is the product of a more stringent process to identify a small set of essential topics. Rather than starting with the topics already found in Stat 101, I considered broad areas of “applied statistics as it is practiced today.” Two examples are causal reasoning and Bayesian inference. I worked backward from these aspirational topics to the foundations needed to support them. For instance, a basic part of causal reasoning is adjustment for covariates. Both “adjustment” and “covariates” need to build on foundations. And so on.</p>
<p>Similarly, techniques such as data wrangling are an important component of today’s applied statistics practice. In forming <em>LST</em>, I looked for a minimal set of foundations for a creditable introduction to data wrangling. These include an ability to compute and the relational operations used in wrangling. But once it is accepted that readers of <em>LST</em> will develop meaningful (if basic) skills in data wrangling it becomes possible to use these skills as part of the exposition of statistics itself.</p>
<p>One advantage of treating causality in depth is reflected in an approach taken in <em>LST</em> to present statistical theory. For instance, statistical thinking involves an important distinction between accuracy and precision. Stat 101 emphasizes precision; the extensive coverage of confidence intervals is an example. But Stat 101 says little about accuracy beyond “take a random sample.” Yet even news reports of applied statistical work routinely include phrases like “after adjusting for ….”</p>
<p><em>LST</em> can draw on causal inference concepts such as causal networks and directed acyclic graphs (DAGs) when illustrating accuracy. With a causal network, the student can see the mechanics exactly. Drawing simulation data from the causal network enables a demonstration of covariates and confounding and what methods, such as adjustment for covariates, can and can’t contribute to accuracy.</p>
<section id="streamlining-explanations" class="level2">
<h2 class="anchored" data-anchor-id="streamlining-explanations">Streamlining explanations</h2>
<p>In addition to minimizing the topic set needed to reach high-level objectives, <em>LST</em> reconsiders the path of introducing statistical basics. To take an example, consider “standard deviation.” Typically, the Stat 101 lead-up to standard deviation starts with “distributions” and the graphical modes for displaying distributions. One of these is the histogram, which then gets smoothed into a continuous density picture of the normal distribution. Then the graphical features of this picture such as the location of the peak and the width of the bell-shaped mountain are associated with statistical word: mean and standard deviation. It’s natural from there to discuss how much of the normal distribution is contained within <span class="math inline">\(\pm 1\)</span> or <span class="math inline">\(\pm\)</span> 2 standard deviations of the peak.</p>
<p>In <em>LST</em>, the path to “standard deviation” is set by reference to a high-level objective: recognizing variation. It’s easy to see variation in a data frame: the differing values of a variable from row to row. But how do you quantify the “amount” of variation? The standard measure of variation in <em>LST</em> is the variance. But there is no need to invoke the normal distribution to understand variance, nor to build it up as the square of the standard deviation. Instead, the explanation of variance starts with a simple question: Given two values of a variable, by how much do they vary? One nice answer is to take the difference in values and then square.</p>
<p>What about the amount of variation in three values of a variable? Generalize the above square difference by calculating the square difference between every pair of the three values. There are three such square differences, so take the average as the measure of variation. A similar process can be followed to measure the variation in any number of values.</p>
<p>The result of this simple process has a name that dates from very early in statistics: 1885. More important for us today is that the result is precisely twice the variance. So divide the average of square pairwise differences by two and you have the variance. There’s no need to refer to the mean or the shape of the normal distribution. Just a common sense average of differences, the only part of which a student will ask for a justification is the squaring.</p>
<p>I think there are cognitive advantages to emphasizing variance rather than standard deviation. Among these are the physical units of a variance: the square of the units of the variable itself. This helps to emphasize that variation in a quantity is a different kind of thing than the quantity itself. More important is the savings that come from not needing to introduce the normal distribution early in the course.</p>
<p>A more important conceptual streamlining in <em>LST</em> involves unifying the various statistical tests in Stat 101 around a single method: regression modeling. The idea of “response” and “explanatory” variables is presented as early as Lesson 2. The Stat 101 distinction between means and proportions—the objects of t- and p-tests respectively—is not at all central. Both t- and p- fit into the framework of regression. In particular, both are instances where there is a single explanatory variable that is categorical.</p>
<p>Similarly, there is no need to emphasize a distinction between so-called one-sample and two-sample settings; both fit nicely into the regression framework. There is a cognitive and motivational gain, I think, in starting with describing relationships between two (or more) variables. The one-sample setting can be handled later as corresponding to an explanatory variable with no variation.</p>
<p><em>LST</em> also streamlines statistical graphics. There is just one fundamental form of data graphic: the annotated point plot. Each point itself refers to a single row of a data frame. In contrast, the annotations refer to the collective properties of the rows. Two types of annotations are available: a “violin” to display density, and a “model” to display trends. From the very start, the model annotations incorporate the uncertainty due to sampling variation. When confidence intervals are introduced in later lessons, the student already has an image of the uncertainty that they quantify. p-values appear only in the last lesson, placed there because (1) a statistically literate person needs to know what they are about, but (2) taking seriously how the 2016 <a href="https://www.amstat.org/asa/files/pdfs/p-valuestatement.pdf">ASA Statement on p-values</a> points to the emphasis on p-values as unfortunate. In any event, students encounter hypothesis testing informally at a much earlier point, checking whether confidence intervals include zero when assessing whether a relationship has been detected or not.</p>
<p>Computing in <em>LST</em> uses R, but the commands are designed around a minimal notation set and aim to be readable, pithy, and easy to emulate. There are no dollar signs, no square or curly braces. The built-in R pipe notation is used systematically to construct commands, and the outputs of modeling summaries are always data frames, hence amenable to the wrangling procedures covered early in <em>LST</em>. Concise modeling and graphics commands, available from the <code>{LSTbook}</code> package on CRAN, follow similar syntactical patterns. For instance, here is a command for a graphical presentation of a model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>Penguins <span class="sc">|&gt;</span> </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">point_plot</span>(bill_length <span class="sc">~</span> mass <span class="sc">+</span> sex <span class="sc">+</span> species, <span class="at">annot =</span> <span class="st">"model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The above command is very similar to a command to generate a quantitative presentation of a model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>Penguins <span class="sc">|&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model_train</span>(bill_length <span class="sc">~</span> mass <span class="sc">+</span> sex <span class="sc">+</span> species) <span class="sc">|&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_interval</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  term                  .lwr    .coef     .upr
  &lt;chr&gt;                &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)      28.4      31.1     33.7    
2 mass              0.000980  0.00175  0.00253
3 sexmale           1.81      2.52     3.23   
4 speciesChinstrap  9.31      9.96    10.6    
5 speciesGentoo     5.08      6.28     7.48   </code></pre>
</div>
</div>
</section>
<section id="the-broader-lst-project" class="level2">
<h2 class="anchored" data-anchor-id="the-broader-lst-project">The broader <em>LST</em> project</h2>
<p>My primary goal with <em>LST</em> is to help students and instructors engage with “applied statistics as it is practiced today.” The <em>Lessons in Statistical Thinking</em> text was written as a demonstration of the extent to which this goal can be met with a one-semester, no-prerequisite course.</p>
<p>More fundamentally, <em>LST</em> embraces what I see as a coherent, connected, and minimal set of topics needed to achieve the goal. Necessarily, not all important topics can be covered in a one-semester, no-prerequisite course. Notable omissions include time series, non-parametrics, and experimental design, among many others. Also omitted, inevitably, are topics that individual instructors think central to how they conceive of statistics, or beautiful in their own right, or addressing specific important applied contexts.</p>
<p>I encourage the instructor to think of <em>LST</em> as a starting point in an ongoing conversation about what topics should be central to the college-level statistics curriculum. And I propose a test for such centrality. Suppose your students had a realistic mastery of the <em>LST</em> topics at a level that might be expected in a one-semester course. Would such students be in a good position to learn topics outside of <em>LST</em> that the instructor individually thinks of as important? For instance, if you teach a course on Bayesian inference or on causal inference, would the background provided by <em>LST</em> be superior to the background gained in a conventional Stat 101 course?</p>
<p>Or, consider any topic or example context you consider essential to a creditable introduction to statistics. Could you adequately address that topic or context using the methods and concepts already in <em>LST</em> as a foundation?</p>
<p>Insofar as the answers to the previous questions are yes, the topics in <em>LST</em> might be considered a standard pre-requisite for students entering into more advanced study. It would be valuable to have a better standard than what we use now to express prerequisites, e.g., “a course in statistics at the AP level.”</p>
<p>Is <em>LST</em> suitable to serve as such a standard? The project is currently the product of one person, albeit one who participates actively in the community discussing change in Stat 101. Perhaps if I could think more clearly about the cognitive foundations of applied statistics, there would be additional topics to add to the standard. And there are likely topics that reflect my idiosyncratic interests and the particular applications of statistics that I have encountered in my career but are not important to a broad community.</p>
<p><em>LST</em> is a free, online, open-source text. I think it can serve as a framework to support the ideas of a broader community of statistics authors. I am open to any mode of publishing material and acknowledging authorship that can sustain and advance the project. If it helps, I do not need to be considered the primary author. (Perhaps it would be worthwhile to adopt a system such as the <a href="https://en.wikipedia.org/wiki/Nicolas_Bourbaki">Bourbaki pseudonym</a> for collective authorship that was active in the first half of the 20th century.) If an author believes that worthwhile extensions require participation of a commercial entity, I’m happy for my contributions to <em>LST</em> to be used appropriately by that entity. Similarly, if a potential author needs help in order to frame her ideas in a way compatible with <em>LST</em>, I am available to provide such help.</p>
<p>Another aspect of the broader project is addressing the limited preparedness of many current statistics instructors. I suspect many instructors will be unfamiliar with important topics in <em>LST</em>. This is likely because a substantial part of the introductory statistics professorship learned statistics by repeatedly teaching Stat 101.</p>
<p>How best to bring such instructors on board while acknowledging the realities of limited time and lack of support from their home institution? (And many teachers of Stat 101, particularly adjuncts, don’t even have a clear home institution that accepts a responsibility for ensuring continuing professional development.) My experience is that seminars and webinars are only minimally effective at helping instructors make a change in their teaching. Short courses at professional meetings are little better. Still, participants in such courses quickly saturate their ability to assimilate new information and, more damagingly, have no way to deal with the academic politics that so often stands in the way of innovation.</p>
<p>Better alternatives might be a two-hour per week, semester-long walk-through of the topics, done primarily in discussion format and then transformed into an asynchronous web resource. Short courses are more likely to be successful if the people involved can shape institutional decisions. In very small programs, one or two instructors may control the curriculum. With larger programs, the short course is best provided at the initiative of administrative leaders and department chairs and involves a large fraction of the statistics faculty as well as representatives of allied disciplines that require statistics of their students.</p>
<p>Please let me know if you might be interested in collaborating on the broad project as a potential author of extensions or as a leader or participant in outreach efforts. I’m also interested in hearing from colleagues who see <em>LST</em> as missing potential opportunities or who have ideas for further streamlining topics.</p>
</section>
<section id="sec-reform-case" class="level2">
<h2 class="anchored" data-anchor-id="sec-reform-case">A case for reforming Stat 101</h2>
<p>A reasonable outsider might presume that orienting students to “applied statistics as it is practiced today” is the purpose of the “Stat 101” courses that are ubiquitous in colleges and universities. There are already many textbooks for Stat 101, some of which have been refined over 10 to 30 years of successive editions. These books employ a variety of pedagogical approaches and use different examples, but they are mainly similar in the set of topics covered, a canonical set recognizable to all instructors teaching Stat 101.</p>
<p>Regrettably, the canonical Stat 101 topics are not strongly oriented to “applied statistics as it is practiced today.” Instead, the topics cover mainly techniques and theory from the early 20th century with a handful of additions from as recently as 1980. To the typical Stat 101 instructor, often trained in mathematics, the focus on historically early topics makes sense; that is the orientation of other components of the math curriculum such as algebra and calculus.</p>
<p>I have asked many mathematics instructors what parts of the algebra, calculus, and trigonometry curriculum reflect developments in the last century. The typical response is that the question is irrelevant; those topics were fully developed long ago.</p>
<p>However, applied statisticians, when asked what techniques they have used that are new in the last 50 years, can construct a long list. This will include machine learning, causal inference, renewed interest in Bayesian inference, logistic regression, statistical computing, data wrangling, bootstrapping, new types of graphics, and so on.</p>
<p>Stat 101 fails to address these topics. It even fails to address statistical techniques that are ubiquitous in applied work, such as adjustment for covariates. There are a variety of explanations for this failure. The course is already too crowded and the textbooks too thick; there’s no space for additional topics. Or, students are not ready to handle such “advanced” topics. Or, these topics often involve “black box” computing, but our goal is to understand the basic ideas underlying statistics. Or even, Bayesian and causal inference are not broadly accepted as legitimate statistical methods.</p>
<p>I think that such “explanations” are merely justifications for not reforming Stat 101. Is the course too crowded? Then, throw some items overboard. The new topics are too advanced? Figure out how to teach or motivate them in an accessible way. Is too much computing needed? Make computing more straightforward and accessible.</p>
<p>The Stat 101 topics are also stabilized by a lack of contact of instructors with a broader statistics education community. My personal experiences working with hundreds of instructors from a wide variety of institutions suggest that most instructors are yet aware of significant developments from 2016, such as the ASA GAISE report or the ASA Statement on p-values. An instructor who has not met the extensive critique of p-values is unlikely to prioritize reducing the coverage of p-values in his or her course.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>